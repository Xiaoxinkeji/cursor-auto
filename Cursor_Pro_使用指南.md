# Cursor Pro 自动化工具使用指南

## 目录

- [项目概述](#项目概述)
- [系统架构](#系统架构)
- [安装指南](#安装指南)
- [配置说明](#配置说明)
- [使用教程](#使用教程)
- [常见问题](#常见问题)
- [高级功能](#高级功能)
- [安全注意事项](#安全注意事项)
- [认证模式](#认证模式)

## 项目概述

Cursor Pro 自动化工具是一个用于自动化 Cursor IDE 账号注册和令牌刷新的开源项目。该工具能够帮助用户自动完成以下操作：

- 自动注册 Cursor 账号
- 自动处理邮箱验证码
- 自动重置机器码
- 更新认证信息

本项目仅用于学习和研究目的，旨在深入理解浏览器自动化和验证码处理技术。

## 系统架构

### 核心组件

项目由以下核心组件构成：

1. **主程序 (cursor_pro_keep_alive.py)**
   - 控制整体流程
   - 处理用户界面交互
   - 协调各模块工作

2. **邮箱验证模块 (get_email_code.py)**
   - 支持IMAP和POP3邮箱验证方式
   - 自动获取验证码
   - 处理邮件清理

3. **浏览器管理模块 (browser_utils.py)**
   - 初始化和配置浏览器
   - 管理浏览器会话
   - 支持代理设置

4. **认证管理模块 (cursor_auth_manager.py)**
   - 更新Cursor认证信息
   - 适配不同操作系统

5. **机器码重置模块 (reset_machine.py)**
   - 重置Cursor机器标识
   - 生成新的唯一ID

6. **配置管理模块 (config.py)**
   - 加载环境变量
   - 验证配置有效性
   - 提供配置访问接口

### 数据流程

1. 用户启动程序 → 选择操作模式
2. 如选择完整注册流程：
   - 初始化浏览器 → 生成随机账号 → 访问注册页面
   - 填写表单 → 处理验证码 → 获取邮箱验证码 → 完成注册
   - 获取会话令牌 → 更新认证信息 → 重置机器码
3. 如选择仅重置机器码：
   - 直接执行机器码重置操作

## 安装指南

### 环境要求

- Python 3.8 或更高版本
- Google Chrome 浏览器
- 支持 Windows、macOS 和 Linux

### 安装步骤

1. **克隆或下载项目**

```bash
git clone https://github.com/chengazhen/cursor-auto-free.git
cd cursor-auto-free
```

2. **安装依赖**

```bash
pip install -r requirements.txt
```

3. **配置环境变量**

复制 `.env.example` 文件为 `.env`，并按照[配置说明](#配置说明)部分进行设置。

```bash
cp .env.example .env
```

4. **运行程序**

```bash
python cursor_pro_keep_alive.py
```

### 使用已编译版本

您也可以从项目的 Releases 页面下载预编译版本，无需安装 Python 环境。

## 配置说明

配置文件 `.env` 包含以下重要参数：

### 基础配置

```
DOMAIN='你的域名'  # Cloudflare 域名或其他邮箱域名
```

### IMAP 邮箱配置

设置 `TEMP_MAIL=null` 以启用 IMAP 模式：

```
DOMAIN='wozhangsan.me'  # 你的域名
TEMP_MAIL=null  # 必须设为null以启用IMAP模式

# IMAP服务器配置
IMAP_SERVER=imap.服务器地址  # 例如：imap.gmail.com
IMAP_PORT=服务器端口         # 通常为 993
IMAP_USER=邮箱地址           # 完整邮箱地址
IMAP_PASS=授权码             # 邮箱授权码（非登录密码）
IMAP_DIR=邮箱文件夹          # [可选] 默认为收件箱(inbox)
IMAP_PROTOCOL=IMAP          # 指定使用 IMAP 或 POP3 协议
```

### 浏览器配置

```
# 无头模式 (默认开启)
BROWSER_HEADLESS='True'

# 自定义浏览器路径
BROWSER_PATH='浏览器可执行文件路径'

# 代理配置
BROWSER_PROXY='http://user:pass@host:port'
```

## 使用教程

### 基本操作流程

1. 启动程序后，会显示以下选项：
   ```
   请选择操作模式:
   0. 退出程序
   1. 仅重置机器码
   2. 传统注册流程（直接修改数据库）
   3. 混合认证注册流程（尝试两种方式）
   4. 引导式注册流程（使用系统默认浏览器）
   5. 启动登录状态监控
   ```

2. **仅重置机器码模式**：
   - 选择选项 1
   - 程序将自动检测Cursor版本并执行适当的重置操作
   - 成功后显示新的机器ID

3. **完整注册流程**：
   - 选择选项 2
   - 程序将自动初始化浏览器、生成随机账号
   - 自动完成注册、验证、获取令牌和重置机器码等操作
   - 成功后将显示注册的账号信息

### 引导式注册流程

引导式注册流程使用系统默认浏览器而非内置浏览器，提供更自然的用户体验:

1. **系统默认浏览器**：使用您已登录的浏览器环境，保留现有的Cookie和登录状态
2. **交互式指导**：程序提供步骤引导，帮助您完成注册和验证过程
3. **手动与自动结合**：保留关键的自动化步骤（邮箱验证、令牌获取），同时允许用户手动干预
4. **更高成功率**：由于使用系统浏览器，登录成功率可能更高，特别是对于某些网络环境

使用方法：
1. 在主菜单中选择"4. 引导式注册流程（使用系统默认浏览器）"
2. 程序会自动生成账号信息并打开系统默认浏览器
3. 按照屏幕上的指导完成注册和验证步骤
4. 程序会自动获取验证码并提示您输入
5. 完成注册后，程序会引导您获取会话令牌并更新Cursor认证信息

推荐使用场景：
- 自动注册流程遇到问题时
- 在有复杂网络环境（如公司网络、代理等）的情况下
- 当您希望对登录过程有更多控制时

### 注册流程详解

1. **初始化阶段**
   - 检查系统环境和Cursor版本
   - 初始化浏览器会话
   - 生成随机用户信息和邮箱

2. **注册阶段**
   - 自动访问Cursor注册页面
   - 填写用户信息并提交
   - 处理可能出现的Turnstile验证

3. **验证阶段**
   - 设置密码
   - 获取并输入邮箱验证码
   - 完成账号验证

4. **完成阶段**
   - 获取会话令牌
   - 更新Cursor认证信息
   - 重置机器码
   - 显示账号信息和额度信息

## 常见问题

### 验证码获取失败

**问题**: 程序无法获取邮箱验证码。

**解决方案**:
1. 检查邮箱配置是否正确
2. 检查网络连接是否稳定
3. 增加重试次数和间隔
4. 确保IMAP/POP3服务已在邮箱设置中启用

### 浏览器启动失败

**问题**: 程序无法启动或控制浏览器。

**解决方案**:
1. 确保已安装Chrome浏览器
2. 尝试设置`BROWSER_HEADLESS='False'`查看具体问题
3. 检查是否有其他进程占用了浏览器
4. 尝试指定具体的浏览器路径

### 机器码重置失败

**问题**: 无法成功重置机器码。

**解决方案**:
1. 确保Cursor未在运行中
2. 检查Cursor配置文件的权限
3. 对于0.45以上版本，使用适当的重置方法
4. 以管理员权限运行程序

## 高级功能

### 自定义邮箱域名

您可以通过设置自己的Cloudflare Workers来自定义邮箱域名，使验证邮件转发到您的真实邮箱。

### 代理配置

对于网络受限的环境，可以配置代理服务器：

```
BROWSER_PROXY='http://user:pass@host:port'
```

### 批量操作

通过修改源代码中的循环逻辑，可以实现批量注册和管理账号的功能。

## 安全注意事项

1. **账号安全**
   - 不要将生成的账号信息公开分享
   - 定期更改密码增强安全性

2. **数据保护**
   - 避免在公共环境运行程序
   - 不要将包含敏感信息的配置文件上传到公共仓库

3. **合规使用**
   - 遵守Cursor的服务条款
   - 仅用于学习和个人使用，不得用于商业目的

---

**免责声明**: 本项目仅供学习和研究目的，使用者需自行承担使用风险和法律责任。

## 认证模式

CursorPro自动化工具提供了两种认证模式，以确保最佳的登录成功率：

### 1. 传统认证模式

传统认证模式直接修改Cursor的SQLite数据库（state.vscdb），将令牌信息和账号信息写入数据库，然后重启Cursor应用。这种方式稳定可靠，适用于大多数场景。

**工作流程**：
1. 获取会话令牌
2. 重置机器码（如需要）
3. 直接修改SQLite数据库
4. 重启Cursor应用
5. 验证登录状态

### 2. 混合认证模式（新功能）

混合认证模式结合了数据库修改和浏览器登录状态保持两种方式，尝试最大程度提高登录的成功率。这种方式对于某些特殊情况下的登录问题可能更有效。

**工作流程**：
1. 获取会话令牌
2. 更新SQLite数据库（传统方式）
3. 重置机器码（如需要）
4. 保持浏览器处于登录状态
5. 重启Cursor应用
6. 延迟一段时间，保持浏览器开启（让Cursor有机会访问浏览器）
7. 关闭浏览器
8. 验证登录状态

### 选择认证模式

在主菜单中，您可以选择不同的操作模式：
```
请选择操作模式:
0. 退出程序
1. 仅重置机器码
2. 传统注册流程（直接修改数据库）
3. 混合认证注册流程（尝试两种方式）
4. 引导式注册流程（使用系统默认浏览器）
5. 启动登录状态监控
```

- 选项2：使用传统的直接数据库修改方式
- 选项3：使用新的混合认证方式

**推荐**：
- 对于大多数用户，传统认证模式（选项2）稳定可靠，通常足够满足需求
- 如果传统模式遇到问题，可以尝试混合认证模式（选项3）
- 对于某些特殊环境或配置，混合认证模式可能提供更好的兼容性 